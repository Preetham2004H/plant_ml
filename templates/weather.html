<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather - PlantCare AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Add Leaflet for map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: #1a1f2e;
            color: white;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 90px;
            height: 100vh;
            background: rgba(20, 25, 35, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 0;
            z-index: 1000;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }

        .logo {
            font-size: 1.8rem;
            margin-bottom: 50px;
            color: #4ade80;
        }

        .sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .nav-item {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.3rem;
            position: relative;
        }

        .nav-item.active {
            background: rgba(74, 222, 128, 0.15);
            color: #4ade80;
        }

        .nav-item:hover {
            background: rgba(74, 222, 128, 0.1);
            color: #4ade80;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-top: auto;
            cursor: pointer;
            border: 2px solid rgba(74, 222, 128, 0.3);
            object-fit: cover;
        }

        /* Main Container */
        .main-container {
            margin-left: 90px;
            padding: 25px 30px;
            min-height: 100vh;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: 1fr 500px;
            gap: 25px;
            height: calc(100vh - 50px);
        }

        /* Left Column */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
        }

        /* Main Weather Card */
        .main-weather-card {
            background: linear-gradient(135deg, #2d3e5f 0%, #3d4d6f 100%);
            border-radius: 32px;
            padding: 35px;
            position: relative;
            overflow: hidden;
        }

        .search-container {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            padding: 15px 25px;
            color: white;
            font-size: 0.95rem;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .search-input:focus {
            outline: none;
            border-color: rgba(74, 222, 128, 0.3);
        }

        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .weather-main-content {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .weather-icon-large {
            font-size: 140px;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }

        .weather-info {
            flex: 1;
        }

        .temperature-display {
            font-size: 92px;
            font-weight: 200;
            line-height: 1;
            margin-bottom: 10px;
        }

        .weather-description {
            font-size: 1.15rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
        }

        .location-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .date-info {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-top: 8px;
        }

        /* Forecast Section */
        .forecast-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 25px;
        }

        .forecast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .forecast-title {
            font-size: 1.15rem;
            font-weight: 600;
        }

        .forecast-dropdown {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 8px 15px;
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        .forecast-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 18px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .forecast-item:hover {
            background: rgba(0, 0, 0, 0.3);
            transform: translateY(-3px);
        }

        .forecast-day {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 12px;
        }

        .forecast-icon {
            font-size: 2.5rem;
            margin: 12px 0;
        }

        .forecast-temps {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .forecast-temp-high {
            font-size: 1.05rem;
            font-weight: 600;
        }

        .forecast-temp-low {
            font-size: 1.05rem;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Weather Map */
        .weather-map {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 25px;
            position: relative;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .map-container {
            background: rgba(20, 30, 45, 0.5);
            border-radius: 16px;
            height: 420px;
            position: relative;
            overflow: hidden;
        }

        #weatherMap {
            width: 100%;
            height: 100%;
            border-radius: 16px;
        }

        .map-controls {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .map-control-btn {
            width: 42px;
            height: 42px;
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .map-control-btn:hover {
            background: rgba(74, 222, 128, 0.2);
            border-color: rgba(74, 222, 128, 0.5);
        }

        /* Right Column - Highlights */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 25px;
            overflow-y: auto;
        }

        .highlights-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 25px;
        }

        .highlights-title {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 25px;
        }

        .highlights-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
        }

        .highlight-card {
            background: rgba(20, 30, 45, 0.5);
            border-radius: 18px;
            padding: 20px;
        }

        .highlight-card.large {
            grid-column: span 2;
        }

        .highlight-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .highlight-value {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .highlight-unit {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }

        .highlight-subtext {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Wind Chart */
        .wind-chart {
            margin-top: 15px;
            height: 60px;
        }

        .wind-wave {
            width: 100%;
            height: 100%;
        }

        /* Animate wind wave */
        @keyframes windFlow {
            0% { d: path("M 0 30 Q 20 10, 40 30 T 80 30 T 120 30 T 160 30 T 200 30"); }
            50% { d: path("M 0 30 Q 20 40, 40 30 T 80 30 T 120 30 T 160 30 T 200 30"); }
            100% { d: path("M 0 30 Q 20 10, 40 30 T 80 30 T 120 30 T 160 30 T 200 30"); }
        }

        /* UV Gauge */
        .uv-gauge {
            margin-top: 15px;
            height: 80px;
            position: relative;
        }

        .uv-gauge svg {
            width: 100%;
            height: 100%;
        }

        /* Sunrise/Sunset Chart */
        .sun-chart {
            margin-top: 15px;
            height: 100px;
            position: relative;
        }

        .sun-chart svg {
            width: 100%;
            height: 100%;
        }

        .sun-times {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .sun-time {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sun-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
            margin-bottom: 5px;
        }

        /* Crop Recommendation */
        .crop-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 25px;
        }

        .crop-title {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
            display: block;
        }

        .form-control, .form-select {
            width: 100%;
            background: rgba(20, 30, 45, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            font-size: 0.9rem;
        }

        .form-control:focus, .form-select:focus {
            outline: none;
            border-color: rgba(74, 222, 128, 0.5);
            background: rgba(20, 30, 45, 0.8);
        }

        .form-select option {
            background: #1e293b;
        }

        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            border: none;
            border-radius: 12px;
            padding: 14px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 222, 128, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .crop-result {
            background: rgba(20, 30, 45, 0.6);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .info-badge {
            background: rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: rgba(251, 191, 36, 0.9);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Loading State */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #4ade80;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(74, 222, 128, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 222, 128, 0.5);
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .weather-grid {
                grid-template-columns: 1fr 450px;
            }
        }

        @media (max-width: 1200px) {
            .weather-grid {
                grid-template-columns: 1fr;
                height: auto;
            }

            .right-column {
                max-height: none;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                padding: 20px 0;
            }

            .main-container {
                margin-left: 70px;
                padding: 15px;
            }

            .weather-main-content {
                flex-direction: column;
                text-align: center;
            }

            .temperature-display {
                font-size: 70px;
            }

            .forecast-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .highlights-grid {
                grid-template-columns: 1fr;
            }

            .highlight-card.large {
                grid-column: span 1;
            }
        }

        .no-data-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .no-data-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        /* Leaflet customization */
        .leaflet-container {
            background: rgba(20, 30, 45, 0.5);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="bi bi-asterisk"></i>
        </div>
        <div class="sidebar-nav">
            <div class="nav-item active" title="Weather">
                <i class="bi bi-cloud-sun"></i>
            </div>
            <div class="nav-item" onclick="window.location.href='/dashboard'" title="Dashboard">
                <i class="bi bi-grid-3x3-gap"></i>
            </div>
            <div class="nav-item" onclick="window.location.href='/detect'" title="Detection">
                <i class="bi bi-camera"></i>
            </div>
            <div class="nav-item" title="Map">
                <i class="bi bi-map"></i>
            </div>
            <div class="nav-item" onclick="getUserLocation()" title="Location">
                <i class="bi bi-geo-alt"></i>
            </div>
            <div class="nav-item" title="Moon">
                <i class="bi bi-moon"></i>
            </div>
            <div class="nav-item" title="Calendar">
                <i class="bi bi-calendar3"></i>
            </div>
            <div class="nav-item" title="Settings">
                <i class="bi bi-gear"></i>
            </div>
        </div>
        <img src="https://ui-avatars.com/api/?name=User&background=4ade80&color=fff" class="user-avatar" alt="User" onclick="logout()">
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <div class="weather-grid">
            <!-- Left Column -->
            <div class="left-column">
                <!-- Main Weather Card -->
                <div class="main-weather-card">
                    <div class="search-container">
                        <input type="text" class="search-input" id="cityInput" placeholder="Search for cities" value="Bangalore">
                        <button class="search-btn" onclick="getWeather()">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>

                    <div id="weatherMainDisplay">
                        <div class="no-data-state">
                            <div class="no-data-icon">
                                <i class="bi bi-cloud-sun"></i>
                            </div>
                            <p>Search for a city to see weather information</p>
                        </div>
                    </div>
                </div>

                <!-- 7 Days Forecast -->
                <div class="forecast-section" id="forecastSection" style="display: none;">
                    <div class="forecast-header">
                        <div class="forecast-title">7 days Forecast</div>
                        <select class="forecast-dropdown">
                            <option>7 day</option>
                            <option>14 day</option>
                        </select>
                    </div>
                    <div class="forecast-grid" id="forecastGrid"></div>
                </div>

                <!-- Weather Map -->
                <div class="weather-map" id="weatherMapSection" style="display: none;">
                    <div class="map-header">
                        <div class="forecast-title">Weather condition map</div>
                        <select class="forecast-dropdown" id="mapLayerSelect" onchange="changeMapLayer(this.value)">
                            <option value="precipitation_new">Precipitation</option>
                            <option value="clouds_new">Clouds</option>
                            <option value="temp_new">Temperature</option>
                            <option value="wind_new">Wind Speed</option>
                        </select>
                    </div>
                    <div class="map-container">
                        <div id="weatherMap"></div>
                    </div>
                    <div class="map-controls">
                        <button class="map-control-btn" onclick="zoomMapIn()">
                            <i class="bi bi-plus"></i>
                        </button>
                        <button class="map-control-btn" onclick="zoomMapOut()">
                            <i class="bi bi-dash"></i>
                        </button>
                        <button class="map-control-btn" onclick="centerMapOnCity()">
                            <i class="bi bi-crosshair"></i>
                        </button>
                        <button class="map-control-btn" onclick="toggleMapLayer()">
                            <i class="bi bi-layers"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="right-column">
                <!-- Highlights -->
                <div class="highlights-section" id="highlightsSection" style="display: none;">
                    <div class="highlights-title">Today's Highlight</div>
                    <div class="highlights-grid">
                        <!-- Wind Status -->
                        <div class="highlight-card">
                            <div class="highlight-label">Wind Status</div>
                            <div class="highlight-value">
                                <span id="windSpeed">-</span><span class="highlight-unit">km/h</span>
                            </div>
                            <div class="wind-chart">
                                <svg class="wind-wave" viewBox="0 0 200 60">
                                    <defs>
                                        <linearGradient id="windGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#4ade80;stop-opacity:0.3" />
                                            <stop offset="100%" style="stop-color:#4ade80;stop-opacity:0" />
                                        </linearGradient>
                                    </defs>
                                    <path id="windPath" d="M 0 30 Q 20 10, 40 30 T 80 30 T 120 30 T 160 30 T 200 30"
                                          stroke="#4ade80"
                                          stroke-width="2"
                                          fill="none"/>
                                    <path d="M 0 30 Q 20 10, 40 30 T 80 30 T 120 30 T 160 30 T 200 30 L 200 60 L 0 60 Z"
                                          fill="url(#windGradient)"/>
                                    <!-- Add wind bars -->
                                    <rect x="40" y="20" width="3" height="10" fill="#4ade80" opacity="0.6" id="bar1"/>
                                    <rect x="80" y="25" width="3" height="15" fill="#4ade80" opacity="0.6" id="bar2"/>
                                    <rect x="120" y="15" width="3" height="20" fill="#4ade80" opacity="0.6" id="bar3"/>
                                    <rect x="160" y="22" width="3" height="12" fill="#4ade80" opacity="0.6" id="bar4"/>
                                </svg>
                            </div>
                            <div class="highlight-subtext">
                                <i class="bi bi-clock"></i> <span id="windTime">-</span>
                            </div>
                        </div>

                        <!-- UV Index -->
                        <div class="highlight-card">
                            <div class="highlight-label">UV Index</div>
                            <div class="highlight-value">
                                <span id="uvIndex">-</span><span class="highlight-unit">UV</span>
                            </div>
                            <div class="uv-gauge">
                                <svg viewBox="0 0 120 60">
                                    <!-- Background arc -->
                                    <path d="M 15 55 A 45 45 0 0 1 105 55"
                                          stroke="rgba(255, 255, 255, 0.1)"
                                          stroke-width="10"
                                          fill="none"
                                          stroke-linecap="round"/>
                                    <!-- Animated arc -->
                                    <path id="uvGaugePath" d="M 15 55 A 45 45 0 0 1 60 10"
                                          stroke="#60a5fa"
                                          stroke-width="10"
                                          fill="none"
                                          stroke-linecap="round"
                                          style="transition: stroke-dasharray 0.5s ease;"/>
                                </svg>
                            </div>
                        </div>

                        <!-- Sunrise & Sunset -->
                        <div class="highlight-card large">
                            <div class="highlight-label">Sunrise & Sunset</div>
                            <div class="sun-chart">
                                <svg viewBox="0 0 250 100">
                                    <defs>
                                        <linearGradient id="sunGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:0.2" />
                                            <stop offset="50%" style="stop-color:#f59e0b;stop-opacity:0.4" />
                                            <stop offset="100%" style="stop-color:#fbbf24;stop-opacity:0.2" />
                                        </linearGradient>
                                    </defs>
                                    <!-- Arc path -->
                                    <path d="M 30 80 Q 125 15, 220 80"
                                          stroke="url(#sunGradient)"
                                          stroke-width="2"
                                          fill="none"
                                          stroke-dasharray="5,5"/>
                                    <!-- Sun icons with glow -->
                                    <g id="sunriseIcon">
                                        <circle cx="60" cy="70" r="10" fill="#fbbf24"/>
                                        <circle cx="60" cy="70" r="15" fill="#fbbf24" opacity="0.2"/>
                                    </g>
                                    <g id="sunsetIcon">
                                        <circle cx="190" cy="70" r="10" fill="#f97316"/>
                                        <circle cx="190" cy="70" r="15" fill="#f97316" opacity="0.2"/>
                                    </g>
                                    <!-- Vertical lines -->
                                    <line x1="60" y1="80" x2="60" y2="85" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                    <line x1="190" y1="80" x2="190" y2="85" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="sun-times">
                                <div class="sun-time">
                                    <div class="sun-label">Sunrise</div>
                                    <div id="sunriseTime">-</div>
                                </div>
                                <div class="sun-time">
                                    <div class="sun-label">Sunset</div>
                                    <div id="sunsetTime">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- Humidity -->
                        <div class="highlight-card">
                            <div class="highlight-label">Humidity</div>
                            <div class="highlight-value">
                                <span id="humidity">-</span><span class="highlight-unit">%</span>
                            </div>
                            <div class="highlight-subtext">
                                <i class="bi bi-droplet"></i> The dew point is <span id="dewPoint">-</span> right now
                            </div>
                        </div>

                        <!-- Visibility -->
                        <div class="highlight-card">
                            <div class="highlight-label">Visibility</div>
                            <div class="highlight-value">
                                <span id="visibility">-</span><span class="highlight-unit">km</span>
                            </div>
                            <div class="highlight-subtext">
                                <i class="bi bi-eye"></i> <span id="visibilityStatus">-</span>
                            </div>
                        </div>

                        <!-- Feels Like -->
                        <div class="highlight-card">
                            <div class="highlight-label">Feels Like</div>
                            <div class="highlight-value">
                                <span id="feelsLike">-</span><span class="highlight-unit">¬∞</span>
                            </div>
                            <div class="highlight-subtext">
                                <i class="bi bi-thermometer-half"></i> Humidity is making it feel hotter
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Crop Recommendation -->
                <div class="crop-section">
                    <div class="crop-title">
                        <i class="bi bi-seedling"></i> Crop Recommendation
                    </div>

                    <div class="info-badge">
                        <i class="bi bi-info-circle"></i>
                        Get weather data first for accurate recommendations
                    </div>

                    <div class="form-group">
                        <label class="form-label">Temperature (¬∞C)</label>
                        <input type="number" class="form-control" id="temperature" placeholder="Auto-filled" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Humidity (%)</label>
                        <input type="number" class="form-control" id="humidityInput" placeholder="Auto-filled" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Rainfall (mm)</label>
                        <input type="number" class="form-control" id="rainfall" placeholder="Auto-filled" readonly>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Soil Type</label>
                        <select class="form-select" id="soilType">
                            <option value="">Select Soil Type</option>
                            <option value="loamy">Loamy Soil</option>
                            <option value="clay">Clay Soil</option>
                            <option value="sandy">Sandy Soil</option>
                            <option value="silt">Silt Soil</option>
                            <option value="red">Red Soil</option>
                            <option value="black">Black Soil</option>
                        </select>
                    </div>

                    <button class="btn-primary" id="cropBtn" onclick="getCropRecommendation()" disabled>
                        <i class="bi bi-lightbulb"></i> Get Recommendations
                    </button>

                    <div class="crop-result" id="cropResult"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let currentWeatherData = null;
        let currentCity = '';
        let weatherMap = null;
        let weatherLayer = null;
        let currentMapLayer = 'precipitation_new';
        let mapInitialized = false;
        let currentMapCenter = [12.9716, 77.5946];
        let cityMarker = null;

        function logout() {
            fetch('/api/logout', { method: 'POST' })
                .then(() => window.location.href = '/');
        }

        // Initialize weather map with Leaflet
        function initWeatherMap(lat, lon, cityName) {
            if (!mapInitialized) {
                weatherMap = L.map('weatherMap', {
                    center: [lat, lon],
                    zoom: 8,
                    zoomControl: false
                });

                // Base layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap',
                    opacity: 0.6
                }).addTo(weatherMap);

                // Weather layer (add your OpenWeatherMap API key)
                const OWM_API_KEY = 'YOUR_API_KEY'; // Get from https://openweathermap.org/register

                if (OWM_API_KEY !== 'YOUR_API_KEY') {
                    weatherLayer = L.tileLayer(
                        `https://tile.openweathermap.org/map/${currentMapLayer}/{z}/{x}/{y}.png?appid=${OWM_API_KEY}`,
                        {
                            attribution: '¬© OpenWeatherMap',
                            opacity: 0.6
                        }
                    ).addTo(weatherMap);
                }

                mapInitialized = true;
            } else {
                weatherMap.setView([lat, lon], 8);
            }

            // Add/update marker
            if (cityMarker) {
                weatherMap.removeLayer(cityMarker);
            }
            cityMarker = L.marker([lat, lon]).addTo(weatherMap);
            cityMarker.bindPopup(`<b>${cityName}</b><br>Current Weather`).openPopup();
            currentMapCenter = [lat, lon];
        }

        function changeMapLayer(layer) {
            if (!mapInitialized || !weatherLayer) return;
            currentMapLayer = layer;
            const OWM_API_KEY = 'YOUR_API_KEY';
            if (OWM_API_KEY === 'YOUR_API_KEY') return;

            weatherMap.removeLayer(weatherLayer);
            weatherLayer = L.tileLayer(
                `https://tile.openweathermap.org/map/${layer}/{z}/{x}/{y}.png?appid=${OWM_API_KEY}`,
                { opacity: 0.6 }
            ).addTo(weatherMap);
        }

        function zoomMapIn() { if (weatherMap) weatherMap.zoomIn(); }
        function zoomMapOut() { if (weatherMap) weatherMap.zoomOut(); }
        function centerMapOnCity() {
            if (weatherMap && currentMapCenter) weatherMap.setView(currentMapCenter, 8);
        }
        function toggleMapLayer() {
            if (!weatherLayer) return;
            const opacity = weatherLayer.options.opacity;
            weatherLayer.setOpacity(opacity === 0.6 ? 0 : 0.6);
        }

        // Animate wind chart
        function animateWindChart(windSpeed) {
            const bars = ['bar1', 'bar2', 'bar3', 'bar4'];
            bars.forEach((id, index) => {
                const bar = document.getElementById(id);
                if (bar) {
                    const height = (windSpeed / 30) * 20 + Math.random() * 10;
                    bar.setAttribute('height', height);
                    setTimeout(() => {
                        bar.style.transition = 'height 0.5s ease';
                    }, index * 100);
                }
            });
        }

        // Animate UV gauge
        function animateUVGauge(uvIndex) {
            const maxUV = 11;
            const percentage = (uvIndex / maxUV) * 100;
            const angle = (percentage / 100) * 180;

            const endX = 60 + 45 * Math.cos((180 - angle) * Math.PI / 180);
            const endY = 55 - 45 * Math.sin((180 - angle) * Math.PI / 180);
            const largeArc = angle > 180 ? 1 : 0;

            const path = document.getElementById('uvGaugePath');
            if (path) {
                path.setAttribute('d', `M 15 55 A 45 45 0 ${largeArc} 1 ${endX} ${endY}`);

                // Change color based on UV level
                if (uvIndex <= 2) path.setAttribute('stroke', '#4ade80');
                else if (uvIndex <= 5) path.setAttribute('stroke', '#fbbf24');
                else if (uvIndex <= 7) path.setAttribute('stroke', '#f97316');
                else path.setAttribute('stroke', '#ef4444');
            }
        }

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        try {
                            const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}`);
                            const data = await response.json();
                            const cityName = data.city || data.locality || 'Current Location';
                            document.getElementById('cityInput').value = cityName;
                            await getWeather();
                        } catch (error) {
                            console.error('Geocoding error:', error);
                        }
                    },
                    function(error) {
                        alert('Location access denied');
                    }
                );
            }
        }

        async function getWeather() {
            const city = document.getElementById('cityInput').value.trim();
            if (!city) {
                alert('Please enter a city name');
                return;
            }

            document.getElementById('weatherMainDisplay').innerHTML = `
                <div class="no-data-state">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 20px;">Fetching weather data...</p>
                </div>
            `;

            try {
                const response = await fetch(`/api/weather?city=${encodeURIComponent(city)}`);
                const data = await response.json();

                if (data.success) {
                    currentCity = data.city;
                    currentWeatherData = data.weather;
                    displayWeather(data.weather, data.city);
                    displayForecast(data.weather);
                    updateHighlights(data.weather.current);
                    updateCropInputs(data.weather.current);

                    document.getElementById('forecastSection').style.display = 'block';
                    document.getElementById('weatherMapSection').style.display = 'block';
                    document.getElementById('highlightsSection').style.display = 'block';

                    const lat = data.latitude || data.weather.latitude || 12.9716;
                    const lon = data.longitude || data.weather.longitude || 77.5946;

                    setTimeout(() => {
                        initWeatherMap(lat, lon, data.city);
                    }, 200);
                }
            } catch (error) {
                console.error('Weather error:', error);
            }
        }

        function displayWeather(weather, city) {
            const current = weather.current;
            const temp = Math.round(current.temperature_2m);
            const condition = getWeatherCondition(current.weather_code || 0);
            const icon = getWeatherIcon(current.weather_code || 0);

            const now = new Date();
            const dateString = now.toLocaleDateString('en-US', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
            const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

            document.getElementById('weatherMainDisplay').innerHTML = `
                <div class="weather-main-content">
                    <div class="weather-icon-large">${icon}</div>
                    <div class="weather-info">
                        <div class="temperature-display">${temp}¬∞C</div>
                        <div class="weather-description">${condition}</div>
                        <div class="location-info">
                            <i class="bi bi-geo-alt"></i> ${city}
                        </div>
                        <div class="date-info">
                            <i class="bi bi-calendar3"></i> ${dateString}, ${timeString}
                        </div>
                    </div>
                </div>
            `;
        }

        function displayForecast(weather) {
            const forecastGrid = document.getElementById('forecastGrid');
            forecastGrid.innerHTML = '';
            const days = ['Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday', 'Monday'];
            const currentTemp = Math.round(weather.current.temperature_2m);

            for (let i = 0; i < 7; i++) {
                const high = currentTemp + Math.floor(Math.random() * 6) - 2;
                const low = high - Math.floor(Math.random() * 8) - 5;
                const icon = getRandomWeatherIcon();

                const forecastItem = document.createElement('div');
                forecastItem.className = 'forecast-item';
                forecastItem.innerHTML = `
                    <div class="forecast-day">${i === 0 ? 'Today' : days[i]}</div>
                    <div class="forecast-icon">${icon}</div>
                    <div class="forecast-temps">
                        <span class="forecast-temp-high">+${high}¬∞</span>
                        <span class="forecast-temp-low">/${low}¬∞</span>
                    </div>
                `;
                forecastGrid.appendChild(forecastItem);
            }
        }

        function updateHighlights(current) {
            const windSpeed = current.wind_speed_10m;
            document.getElementById('windSpeed').textContent = windSpeed.toFixed(1);
            document.getElementById('humidity').textContent = current.relative_humidity_2m;
            document.getElementById('feelsLike').textContent = Math.round(current.apparent_temperature || current.temperature_2m);

            const now = new Date();
            document.getElementById('windTime').textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

            // Animate wind chart
            animateWindChart(windSpeed);

            // UV Index
            const uvIndex = Math.floor(Math.random() * 8) + 1;
            document.getElementById('uvIndex').textContent = uvIndex;
            animateUVGauge(uvIndex);

            // Visibility
            const vis = (Math.random() * 5 + 5).toFixed(0);
            document.getElementById('visibility').textContent = vis;
            document.getElementById('visibilityStatus').textContent = vis > 8 ? 'Clear visibility' : 'Moderate visibility';

            // Dew point
            const temp = current.temperature_2m;
            const humidity = current.relative_humidity_2m;
            const dewPoint = Math.round(temp - ((100 - humidity) / 5));
            document.getElementById('dewPoint').textContent = dewPoint + '¬∞C';

            // Sunrise/Sunset
            document.getElementById('sunriseTime').textContent = '5:50 AM';
            document.getElementById('sunsetTime').textContent = '6:30 PM';
        }

        function updateCropInputs(current) {
            document.getElementById('temperature').value = Math.round(current.temperature_2m);
            document.getElementById('humidityInput').value = current.relative_humidity_2m;
            document.getElementById('rainfall').value = current.precipitation || 0;
            document.getElementById('cropBtn').disabled = false;
        }

        async function getCropRecommendation() {
            const temperature = document.getElementById('temperature').value;
            const humidity = document.getElementById('humidityInput').value;
            const rainfall = document.getElementById('rainfall').value;
            const soilType = document.getElementById('soilType').value;

            if (!soilType) {
                alert('Please select a soil type');
                return;
            }

            const cropResult = document.getElementById('cropResult');
            cropResult.style.display = 'block';
            cropResult.innerHTML = `
                <div style="text-align: center;">
                    <div class="loading-spinner" style="width: 30px; height: 30px;"></div>
                    <p style="margin-top: 15px; color: rgba(255,255,255,0.7);">Getting recommendations...</p>
                </div>
            `;

            try {
                const response = await fetch('/api/crop-recommendation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ temperature, humidity, rainfall, soil_type: soilType })
                });
                const data = await response.json();

                if (data.success) {
                    cropResult.innerHTML = `
                        <h6 style="color: #4ade80; margin-bottom: 15px;">
                            <i class="bi bi-check-circle"></i> Recommended Crops
                        </h6>
                        <div style="color: rgba(255,255,255,0.9); line-height: 1.8; font-size: 0.9rem;">
                            ${formatCropText(data.recommendations)}
                        </div>
                    `;
                } else {
                    cropResult.innerHTML = `<div style="text-align: center; color: #ef4444;">Error: ${data.message}</div>`;
                }
            } catch (error) {
                cropResult.innerHTML = `<div style="text-align: center; color: #ef4444;">Failed to get recommendations</div>`;
            }
        }

        function formatCropText(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #4ade80;">$1</strong>')
                .replace(/\n/g, '<br>');
        }

        function getWeatherCondition(code) {
            const conditions = {
                0: 'Clear sky', 1: 'Mainly clear', 2: 'Partly cloudy', 3: 'Overcast',
                45: 'Fog', 51: 'Light drizzle', 61: 'Slight rain', 63: 'Moderate rain',
                80: 'Rain showers', 95: 'Thunderstorm'
            };
            return conditions[code] || 'Rainy Storm Clouds';
        }

        function getWeatherIcon(code) {
            const icons = { 0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 61: 'üåßÔ∏è', 80: 'üå¶Ô∏è', 95: '‚õàÔ∏è' };
            return icons[code] || 'üåßÔ∏è';
        }

        function getRandomWeatherIcon() {
            const icons = ['‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', '‚òÅÔ∏è', 'üå¶Ô∏è', 'üåßÔ∏è'];
            return icons[Math.floor(Math.random() * icons.length)];
        }

        document.getElementById('cityInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') getWeather();
        });
    </script>
</body>
</html>
